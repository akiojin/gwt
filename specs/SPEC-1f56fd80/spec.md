# 機能仕様: Web UI システムトレイ統合とURL表示

**仕様ID**: `SPEC-1f56fd80`  
**作成日**: 2025-12-12  
**ステータス**: ドラフト  
**入力**: ユーザー説明: "WebUI をシステムトレイに常駐させ、ダブルクリックでブラウザを開けるようにしてほしい。CLI のブランチ一覧にも WebUI の URL を表示してほしい。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - Web UI をトレイから素早く開く (優先度: P1)

開発者が `gwt` を起動すると Web UI サーバーがバックグラウンド起動し、同時にシステムトレイへ gwt のアイコンが表示される。  
開発者はそのアイコンを **ダブルクリック** するだけで、既定ブラウザが Web UI の URL を開く。

**この優先度の理由**: Web UI を毎回 URL 入力せずに素早く開けることで、CLI/ブラウザ間の往復をストレスなく行えるため。

**独立したテスト**: `gwt` 起動 → トレイにアイコンが表示されることを確認 → トレイアイコンをダブルクリック → 既定ブラウザで `http://localhost:3000`（または PORT 指定値） が開く。

**受け入れシナリオ**:

1. **前提条件** Git リポジトリ内で `gwt` を起動、**操作** 起動完了を待つ、**期待結果** Web UI サーバー起動後にトレイへアイコンが表示される
2. **前提条件** トレイアイコンが表示済み、**操作** アイコンをダブルクリック、**期待結果** 既定ブラウザが Web UI を開く
3. **前提条件** `PORT=8080 gwt` で起動、**操作** トレイアイコンをダブルクリック、**期待結果** `http://localhost:8080` が開く

---

### ユーザーストーリー 2 - CLI から Web UI の場所をすぐ確認 (優先度: P1)

開発者が CLI のブランチ一覧（BranchListScreen）を表示しているとき、画面内に Web UI の URL が常時表示される。  
開発者はその URL を見て、ブラウザで直接開く/共有するなどの行動が取れる。

**この優先度の理由**: トレイが使えない環境でも URL を一目で確認でき、CLI と Web UI の同時利用がさらに分かりやすくなるため。

**独立したテスト**: `gwt` 起動 → ブランチ一覧画面に `Web UI: http://localhost:{port}` が表示される。

**受け入れシナリオ**:

1. **前提条件** `gwt` が起動しブランチ一覧を表示、**操作** 画面を確認、**期待結果** Web UI の URL 行がフッター付近に表示される
2. **前提条件** `PORT=8080` を設定して起動、**操作** 画面を確認、**期待結果** URL 行が `http://localhost:8080` を指す

---

### エッジケース

- GUI を持たない環境（CI/SSH/WSL など）では、トレイ機能が利用できない可能性がある
  - その場合でも CLI/Web UI の起動は継続し、トレイ初期化失敗は警告ログのみで処理する
- トレイ機能が OS/デスクトップ環境でサポートされない場合でも、アプリはクラッシュしない
- Web UI サーバー起動に失敗した場合はトレイ/URL 表示の両方が行われないが、CLI は継続する（SPEC-c8e7a5b2 に準拠）
- **指定ポートが既に使用中の場合、Web UI サーバー起動をスキップし、CLI のみで動作を継続する**
  - 警告ログを出力し、ユーザーに状況を通知する
  - トレイアイコンも表示されない
  - BranchListScreen の URL 表示もスキップされる

## 要件 *(必須)*

### 機能要件

- **FR-001**: Web UI サーバーが起動完了した後、システムはシステムトレイへ gwt アイコンを表示**しなければならない**
- **FR-002**: トレイアイコンのダブルクリック（アクション）により、既定ブラウザで Web UI URL (`http://localhost:{port}`) を開く**しなければならない**
- **FR-003**: トレイ初期化が失敗/非対応の場合、CLI/Web UI の動作を阻害せず警告ログのみで継続**しなければならない**
- **FR-004**: CLI の BranchListScreen は Web UI の URL を 1 行で表示**しなければならない**
- **FR-005**: 表示/起動に使う URL は `PORT` 環境変数（未設定時は 3000）と一致**しなければならない**
- **FR-006**: 指定ポートが使用中の場合、Web UI サーバー起動をスキップし、CLI のみで動作を継続**しなければならない**

### 主要エンティティ

- **SystemTray**: Web UI 常駐のためのトレイ表示コンポーネント（サーバー起動後に初期化）
- **Web UI URL 表示**: BranchListScreen 内に表示される `Web UI: http://localhost:{port}` 行

## 成功基準 *(必須)*

- **SC-001**: Web UI 起動後、主要 OS（Windows/macOS/Linux）の 90% 以上の環境でトレイアイコンが表示される
- **SC-002**: トレイダブルクリックで 100% 正しい URL が開く（手動テスト 10 ケース）
- **SC-003**: CLI ブランチ一覧に URL が常時表示され、PORT 指定時も 100% 一致
- **SC-004**: トレイ未対応/失敗環境でも CLI/Web UI がクラッシュしない
- **SC-005**: ポート使用中の場合、CLI が正常に起動し、Web UI スキップの警告ログが出力される

## 制約と仮定 *(該当する場合)*

### 制約

- gwt は CLI ツールであり、Electron のような重いランタイム追加は避ける
- トレイ機能は OS の GUI 環境に依存するため、ヘッドレスでは無効化され得る

### 仮定

- Web UI はローカルマシン上でのみ利用され、既定ブラウザも同一マシンに存在する
- PORT の指定は既存仕様（SPEC-c8e7a5b2）に従う

## 範囲外 *(必須)*

- トレイアイコンの右クリックメニュー/設定 UI
- リモートホスト公開や HTTPS 対応
- トレイからのサーバー停止/再起動操作

## 依存関係 *(該当する場合)*

- 既存仕様: SPEC-c8e7a5b2 (CLI 起動時 Web UI 自動起動)
- 既存実装: `src/web/server/index.ts`（Web UI サーバー）
- 既存実装: `src/cli/ui/components/screens/BranchListScreen.tsx`
