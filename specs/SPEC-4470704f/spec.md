# 機能仕様: gwt GUI マルチウィンドウ + Native Windowメニュー

**仕様ID**: `SPEC-4470704f`
**作成日**: 2026-02-09
**ステータス**: ドラフト
**カテゴリ**: GUI
**依存仕様**: `SPEC-d6210238`（GUI基盤）, `SPEC-dfb1611a`（トレイ常駐）
**入力**: ユーザー説明: "gwtはマルチウィンドウ対応にしてもらいたい。メニューのWindowでプロジェクトを切り替えれるようにしたい。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - マルチウィンドウ（1プロジェクト=1ウィンドウ）(優先度: P1)

開発者として、複数プロジェクトを同時に扱うために複数ウィンドウを開き、
各ウィンドウで独立してプロジェクトを開けるようにしたい。
新しいプロジェクトは `File > New Window` から新規ウィンドウを作り、そのウィンドウで Open Project する。

**この優先度の理由**: マルチモニタ運用や複数リポジトリを並行作業する際に、最も頻度が高く効果が大きい。

**独立したテスト**: GUIを起動し `File > New Window` により複数ウィンドウを開き、それぞれで別プロジェクトを開けることを確認できる。

**受け入れシナリオ**:

1. **前提条件** gwt GUIが起動している、**操作** `File > New Window` を実行する、**期待結果** 新しいウィンドウが表示される
2. **前提条件** ウィンドウA/Bが表示されている、**操作** ウィンドウAでプロジェクトAを開き、ウィンドウBでプロジェクトBを開く、**期待結果** 各ウィンドウが独立してそれぞれのプロジェクトを表示する
3. **前提条件** ウィンドウAでプロジェクトAが開かれている、**操作** ウィンドウBで別プロジェクトへ切り替える、**期待結果** ウィンドウAの操作対象（プロジェクト/エージェント起動先）が変化しない

---

### ユーザーストーリー 2 - Windowメニューでウィンドウ（プロジェクト）切替 (優先度: P1)

開発者として、ネイティブの `Window` メニューから開いているプロジェクトウィンドウに素早く切り替え、
複数ウィンドウ運用で迷子にならないようにしたい。

**この優先度の理由**: マルチウィンドウを実用化するための最短導線であり、キーボード/メニューバー操作での切替が重要。

**独立したテスト**: 2つ以上のプロジェクトウィンドウを開き、`Window` メニューから選択してフォーカス移動できることを確認できる。

**受け入れシナリオ**:

1. **前提条件** プロジェクトA/Bを開いたウィンドウA/Bがある、**操作** `Window` メニューを開く、**期待結果** ウィンドウA/Bが一覧表示される
2. **前提条件** ウィンドウA/Bがある、**操作** `Window` メニューからウィンドウBを選択する、**期待結果** ウィンドウBが前面に表示されフォーカスされる
3. **前提条件** ウィンドウBが閉じる操作により非表示になっている（プロセスは継続）、**操作** `Window` メニューからウィンドウBを選択する、**期待結果** ウィンドウBが再表示されフォーカスされる

---

### ユーザーストーリー 3 - Nativeメニューバー統合（in-app menubar廃止）(優先度: P2)

開発者として、アプリ内の疑似メニューバーではなくOSネイティブのメニューバーに操作を統合し、
OS標準の操作感で利用したい。

**この優先度の理由**: Windowメニューはネイティブ実装が自然であり、in-app menubarと二重化するとUXが悪化する。

**独立したテスト**: GUI起動後、in-app menubar が表示されないことと、ネイティブメニューから主要操作が実行できることを確認できる。

**受け入れシナリオ**:

1. **前提条件** gwt GUIが起動している、**操作** 画面上部を確認する、**期待結果** in-app menubar が表示されない
2. **前提条件** プロジェクト未選択、**操作** ネイティブ `File > Open Project...` を実行してフォルダを選択する、**期待結果** プロジェクトが開かれる
3. **前提条件** プロジェクトが開かれている、**操作** ネイティブ `Window > Toggle Sidebar` を実行する、**期待結果** サイドバー表示が切り替わる
4. **前提条件** プロジェクトが開かれている、**操作** ネイティブ `gwt > Preferences...` を実行する、**期待結果** Settings タブが開く

### エッジケース

- 同名ディレクトリ名のプロジェクトが複数開かれている場合でも、Windowメニュー上で区別できること
- プロジェクト未選択のウィンドウは Window メニューに表示されなくても良い（ユーザー要望）
- あるウィンドウでプロジェクトを切り替えても、他ウィンドウのエージェント起動先/設定読み込み先に影響しないこと
- Close Project 後に Window メニューから当該ウィンドウを選べなくなる場合でも、OS標準のウィンドウ操作で復帰できること

## 要件 *(必須)*

### 機能要件

- **FR-400**: アプリケーションはネイティブメニューバー（gwt/File/Window/Debug）を提供**しなければならない**
- **FR-401**: `File > New Window` により新しいアプリウィンドウを作成**しなければならない**
- **FR-402**: プロジェクト状態（open/close、エージェント起動先、設定読み込み先）はウィンドウ単位で保持**しなければならない**
- **FR-403**: `Window` メニューはプロジェクトが開かれているウィンドウを一覧表示**しなければならない**
- **FR-404**: `Window` メニューでウィンドウを選択した場合、そのウィンドウを再表示しフォーカス**しなければならない**
- **FR-405**: in-app menubar（WebView上の疑似メニューUI）を表示**してはならない**
- **FR-406**: `File > Open Project...` は現在のウィンドウに対してプロジェクトを開く**ことができなければならない**
- **FR-407**: `File > Close Project` は現在のウィンドウのプロジェクトを閉じ、Open Project 画面へ戻す**ことができなければならない**
- **FR-408**: 追加ウィンドウ（例: `project-*`）でも dialog/store 等の必要な権限が有効**でなければならない**

### 主要エンティティ

- **Project Window**: 1つのプロジェクトを開いたアプリウィンドウ。ウィンドウラベルと projectPath を持つ
- **Window Menu Entry**: Window メニューに表示されるプロジェクトウィンドウの項目。表示名と対象ウィンドウラベルを持つ

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-400**: 2つ以上のウィンドウで別プロジェクトを同時に開き、互いに干渉せずに操作できる
- **SC-401**: `Window` メニューからの選択で、対象ウィンドウが確実に再表示・フォーカスされる（100%）
- **SC-402**: in-app menubar が表示されない（ネイティブメニューのみで操作できる）

## 制約と仮定 *(該当する場合)*

### 制約

- Tauri v2 + Svelte 5 構成は維持する
- UI表示文字列は英語のみ（日本語を表示しない）
- `CloseRequested` は既存仕様どおり hide（トレイ Quit 以外で終了しない）を維持する

### 仮定

- 開いていない（未選択）プロジェクトは Window メニューに表示しない

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- Window メニューから未オープンのプロジェクトを直接開く機能（Recent Projects 等）
- ウィンドウ状態（位置/サイズ/開いているプロジェクト）の永続化と起動時復元
- ネイティブメニューのOS別の細かな差分調整（必要になった場合は別SPEC）

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- 追加ウィンドウでも必要最小限の権限のみを付与する（capabilities の windows スコープを適切に設定する）

## 依存関係 *(該当する場合)*

- Tauri v2 menu API
- `tauri-plugin-dialog`（Open Project）
- `tauri-plugin-store`（Recent Projects）

## 参考資料 *(該当する場合)*
- [Tauri v2 Menu](https://v2.tauri.app/reference/menu/)
