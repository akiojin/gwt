# 実装計画: 環境変数プロファイル機能（OpenTUI）

**仕様ID**: `SPEC-dafff079` | **日付**: 2026-01-06 | **仕様書**: `/specs/SPEC-dafff079/spec.md`
**入力**: `/specs/SPEC-dafff079/spec.md` からの機能仕様

## 概要

- OpenTUI 版のプロファイルUIを完成させる（一覧/切替/作成/削除/環境変数編集）。
- OS環境変数の閲覧と、プロファイルで上書きされるキーの強調表示を追加する。
- 既存の `profiles.yaml` を読み書きするロジックは流用し、UI から更新を行う。

## 技術コンテキスト

**言語/バージョン**: TypeScript（Bun runtime）
**主要な依存関係**: `@opentui/solid`, `@opentui/core`, `yaml`
**ストレージ**: `~/.gwt/profiles.yaml`
**テスト**: Vitest
**ターゲットプラットフォーム**: macOS / Linux / Windows（WSL/PowerShell）
**プロジェクトタイプ**: 単一（CLI + OpenTUI）
**パフォーマンス目標**: OS環境変数が100件以上でもスクロールが重くならない
**制約**: OpenTUIのみ使用、ASCII表記、既存キーバインドと競合しない
**スケール/範囲**: プロファイル数は10件以下想定、環境変数は100件程度

## 原則チェック

- 原則ファイルはテンプレートのため、追加ゲートは設定しない。

## プロジェクト構造

### ドキュメント（この機能）

```text
specs/SPEC-dafff079/
├── plan.md              # このファイル
└── tasks.md             # 実装タスク一覧
```

### ソースコード（リポジトリルート）

```text
src/
├── cli/ui/App.solid.tsx
├── cli/ui/components/solid/
├── cli/ui/screens/solid/
├── cli/ui/hooks/solid/
├── config/profiles.ts
└── types/profiles.ts
```

## 実装戦略

### 優先順位付け

1. **P1**: 既存の切替・表示は維持（破壊変更なし）
2. **P2**: OS環境変数の表示と上書きハイライト
3. **P3**: 作成/削除/環境変数の編集フロー

### UI方針

- `ProfileScreen` を一覧/切替に使用し、`e/n/d` の追加操作をサポート。
- 環境変数編集は専用画面を追加し、`a/e/d` で追加/編集/削除。
- OS環境変数は別画面で閲覧し、上書きキーを黄色で表示する。
- 入力系は幅32文字のテキスト入力を標準とする。
- 入力モード中はショートカットを無効化し、文字入力を優先する。
- 環境変数の空値はプレースホルダーで表示するが、入力値としては保存しない。
- 新規環境変数作成時は Enter/Tab で値入力へフォーカス移動し、値入力中の Enter で確定する。

## テスト戦略

- 既存のUIテストは維持。
- 新規画面は最小限の表示テストを追加する（必要に応じて）。

## リスクと緩和策

1. **入力キーの残留**: 画面遷移時のキーが入力欄に混入する
   - **緩和策**: 初回入力の抑止フラグを導入する
2. **OS環境変数の描画負荷**: 大量の環境変数で描画が重くなる
   - **緩和策**: `useScrollableList` で表示範囲のみ描画

## 次のステップ

1. ✅ plan.md 作成
2. ⏭️ tasks.md を生成・整理
3. ⏭️ OpenTUI 実装の追加
