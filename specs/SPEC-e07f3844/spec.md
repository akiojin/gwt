# 機能仕様: ヘッダーへの起動ディレクトリ表示

**仕様ID**: `SPEC-e07f3844`
**作成日**: 2025-01-05
**ステータス**: ドラフト
**入力**: ユーザー説明: "起動ディレクトリをヘッダー部分に表示"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - 現在の作業ディレクトリの即座確認 (優先度: P1)

複数のプロジェクトを並行して開発している開発者が、claude-worktreeを起動した際に、どのプロジェクトディレクトリで作業しているかを即座に確認できる。

**この優先度の理由**: 複数プロジェクトを扱う開発者にとって、現在の作業ディレクトリを即座に把握できることは、誤ったディレクトリでの操作を防ぐために不可欠。コア機能として最優先で実装すべき。

**独立したテスト**: claude-worktreeを任意のディレクトリから起動し、ヘッダー部分に表示されるディレクトリパスが起動ディレクトリと一致することを確認することで完全にテストできる。

**受け入れシナリオ**:

1. **前提条件** `/home/user/project-a`ディレクトリでclaude-worktreeを起動、**操作** ヘッダー部分を確認、**期待結果** "Working Directory: /home/user/project-a"が表示される
2. **前提条件** `/var/www/project-b`ディレクトリでclaude-worktreeを起動、**操作** ヘッダー部分を確認、**期待結果** "Working Directory: /var/www/project-b"が表示される
3. **前提条件** 深いディレクトリ階層`/home/user/dev/projects/client/app/backend`で起動、**操作** ヘッダー部分を確認、**期待結果** 完全な絶対パスが表示される

---

### ユーザーストーリー 2 - 視認性の高い配置 (優先度: P2)

ユーザーがclaude-worktreeのUI画面を開いた瞬間に、起動ディレクトリ情報が自然に目に入る位置に配置されている。

**この優先度の理由**: ディレクトリ情報の表示位置は、ユーザビリティに直結する。区切り線の下、統計情報の上という位置は、タイトルと統計の間の自然な視線の流れに沿っている。

**独立したテスト**: ヘッダー部分の要素の順序（タイトル→区切り線→ディレクトリ情報→統計情報）を確認することでテスト可能。

**受け入れシナリオ**:

1. **前提条件** claude-worktreeを起動、**操作** ヘッダー部分の構造を確認、**期待結果** タイトル行→区切り線→"Working Directory:"→統計情報の順序で表示される
2. **前提条件** 通常のターミナルウィンドウサイズ(80文字幅)、**操作** ヘッダーを表示、**期待結果** ディレクトリ情報が1行に収まり、折り返しが発生しない

---

### エッジケース

- 起動ディレクトリのパスが非常に長い場合（例: 100文字以上）、どのように表示されるか？
  - 80文字幅のターミナルでは折り返しが発生する可能性があるが、情報の完全性を優先して全体を表示する
- シンボリックリンク経由でディレクトリに移動してから起動した場合、実際のパスとシンボリックリンクのパス、どちらを表示するか？
  - 絶対パス解決後の実パスを表示する（混乱を避けるため）
- ディレクトリパスに特殊文字（スペース、日本語文字など）が含まれる場合の表示は？
  - そのまま表示する（エスケープ不要）

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムはclaude-worktree起動時の現在の作業ディレクトリの絶対パスを取得**しなければならない**
- **FR-002**: システムは取得したディレクトリパスをヘッダー部分に表示**しなければならない**
- **FR-003**: ディレクトリ情報は"Working Directory: "というラベルで表示**しなければならない**
- **FR-004**: ディレクトリ情報の表示位置は、タイトル行と区切り線の後、統計情報の前で**なければならない**
- **FR-005**: システムは絶対パス形式（例: /home/user/project）でディレクトリを表示**しなければならない**
- **FR-006**: システムはシンボリックリンクを解決した実際のパスを表示**しなければならない**

### 主要エンティティ

この機能は新規のデータエンティティを導入しません。既存の実行環境情報（起動ディレクトリパス）を表示するのみです。

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーはclaude-worktree起動後1秒以内に起動ディレクトリを視認できる
- **SC-002**: 表示されるディレクトリパスは100%の精度で起動ディレクトリと一致する
- **SC-003**: ヘッダー部分の情報密度が適切で、ユーザーが3秒以内にすべての重要情報（タイトル、バージョン、ディレクトリ、統計）を把握できる
- **SC-004**: 80文字幅以上のターミナルで、ディレクトリ情報が視覚的に明瞭に表示される

## 制約と仮定 *(該当する場合)*

### 制約

- 既存のヘッダー表示ロジック（Header.tsx、BranchListScreen.tsx）を活用する必要がある
- 80文字幅のターミナルでの表示を基準とする
- React Inkフレームワークの制約内で実装する必要がある

### 仮定

- ユーザーはGitリポジトリのルートディレクトリまたはそのサブディレクトリでclaude-worktreeを起動する
- Node.jsの`process.cwd()`または既存の`getRepositoryRoot()`関数でディレクトリパスを取得可能
- ターミナルは基本的なUTF-8文字を正しく表示できる

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- ディレクトリパスの短縮表示やカスタマイズオプション（将来的な拡張として検討可能）
- 起動ディレクトリの変更機能
- ディレクトリ情報のクリップボードへのコピー機能
- 相対パス表示やホームディレクトリの`~`記法への変換

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- ディレクトリパス情報はローカル環境内のみで表示され、外部への送信は行わない
- ディレクトリパスに含まれる可能性のあるユーザー名や組織名などの情報は、ローカル開発環境の性質上、セキュリティリスクとはみなさない

## 依存関係 *(該当する場合)*

- 既存のHeader.tsxコンポーネント
- 既存のBranchListScreen.tsxコンポーネント
- Node.jsのprocess.cwd()またはsrc/git.tsのgetRepositoryRoot()関数
- React Inkのレイアウトシステム

## 参考資料 *(該当する場合)*

- [React Ink ドキュメント](https://github.com/vadimdemedes/ink)
- [Node.js process.cwd() リファレンス](https://nodejs.org/api/process.html#processcwd)
