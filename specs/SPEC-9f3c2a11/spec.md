# 機能仕様: Voice Input Mode（GUI）

**仕様ID**: `SPEC-9f3c2a11`  
**作成日**: 2026-02-13  
**カテゴリ**: GUI

## ユーザーシナリオ

### ユーザーストーリー 1 - 全キーボード入力領域で音声入力する (P1)

ユーザーとして、キーボード入力を受け付けるあらゆる入力欄で、グローバルホットキーにより音声入力を開始/停止したい。

**受け入れシナリオ**

1. **前提** 任意の `input/textarea` にフォーカスがある、**操作** 音声入力ホットキーを押して発話する、**期待** 認識結果が該当入力欄へ挿入される。
2. **前提** Agent Mode の入力欄にフォーカスがある、**操作** 音声入力ホットキーで発話する、**期待** 認識結果がテキスト欄へ挿入される（自動送信しない）。
3. **前提** Worktree terminal タブがアクティブでターミナル入力可能、**操作** 音声入力ホットキーで発話する、**期待** 認識結果が terminal に送信される。

### ユーザーストーリー 2 - 設定で音声入力を制御する (P1)

ユーザーとして、Settings で音声入力の有効/無効、ホットキー、言語、モデル設定を管理したい。

**受け入れシナリオ**

1. **前提** Settings を開く、**操作** Voice Input の有効化を切り替えて保存する、**期待** 次回起動後も設定が保持される。
2. **前提** Voice Input が有効、**操作** ホットキーを変更して保存する、**期待** 新しいホットキーで音声入力が起動する。
3. **前提** Voice Input が有効、**操作** 言語を `auto/ja/en` で変更して保存する、**期待** 認識設定に反映される。

## 機能要件

- **FR-001**: システムはグローバルホットキーで音声入力の開始/停止を切り替えできなければならない。
- **FR-002**: システムは `input` / `textarea` / contenteditable / Agent Mode 入力欄に認識結果を挿入しなければならない。
- **FR-003**: システムは terminal が入力ターゲットの場合、既存 terminal 書き込みコマンドを使って認識結果を送信しなければならない。
- **FR-004**: システムは認識結果を自動送信してはならない（入力欄への挿入のみ）。
- **FR-005**: システムは Voice Input 設定（enabled/hotkey/language/model）を settings に保存・復元しなければならない。
- **FR-006**: システムは音声入力の動作状態（待機中/録音中/エラー）をGUIで把握できるようにしなければならない。

## 制約

- 初期対応OSは `macOS` と `Windows`。
- UI文言は英語で提供する。
- 既存のキーボードショートカットと競合しないデフォルトホットキーを採用する。

## 成功基準

- **SC-001**: 主要入力コンポーネント（Settings/Agent Mode/Open Project/Sidebar Search/Launch Form）で音声挿入が成功する。
- **SC-002**: Terminal タブで音声認識テキストが入力として送信される。
- **SC-003**: 設定の保存・再起動復元が自動テストで検証される。
- **SC-004**: 音声入力中でも既存 Enter 送信挙動（Agent Mode）を壊さない。
