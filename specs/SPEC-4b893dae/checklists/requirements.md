# 要件チェックリスト: ブランチサマリーパネル（セッション要約対応）

**目的**: SPEC-4b893daeの機能要件が正しく定義され、テスト可能であることを確認する（セッション要約・タブ切り替え対応）
**作成日**: 2026-01-19
**機能**: [spec.md](../spec.md)

## パネル表示（基本）

- [ ] CHK001 FR-001: フッター領域への常時表示が明確に定義されている
- [ ] CHK002 FR-002: タイトル形式`[branch_name] Details`が具体的に定義されている
- [ ] CHK003 FR-003: 高さ10-15行の固定値が測定可能な基準として定義されている
- [ ] CHK004 FR-004: 枠線表示の要件がRatatui実装と整合している
- [ ] CHK005 FR-005: ブランチ選択変更時の更新トリガーが明確
- [ ] CHK006 FR-006: 既存`Worktree:`表示との統合方法が明確

## コミットログセクション

- [ ] CHK010 FR-010: 表示件数3-5件の範囲指定が適切（固定値vs動的を検討）
- [ ] CHK011 FR-011: ハッシュ7桁+メッセージ形式が既存gitログ形式と整合
- [ ] CHK012 FR-012: 末尾省略`...`の実装方法がRatatuiの文字幅計算と整合
- [ ] CHK013 FR-013: コミットなしケースの表示文言が統一されている

## 変更統計セクション

- [ ] CHK020 FR-020: `Stats:`ラベルの表示位置が明確
- [ ] CHK021 FR-021: `N files, +X/-Y lines`形式がdiff統計と整合
- [ ] CHK022 FR-022: 未コミット検出がSPEC-d2f4762aの既存ロジックと同一
- [ ] CHK023 FR-023: 未プッシュ検出がSPEC-d2f4762aの既存ロジックと同一
- [ ] CHK024 FR-024: 安全性判定データ共有の実装方法が明確

## ブランチメタデータセクション

- [ ] CHK030 FR-030: `Meta:`ラベルの表示位置が明確
- [ ] CHK031 FR-031: ahead/behind表示形式`↑N ↓M from <upstream>`がASCII制約を満たす
- [ ] CHK032 FR-032: 相対日時表示の基準時刻と形式が明確（`2 days ago`等）
- [ ] CHK033 FR-033: ベースブランチ情報の取得元が明確（upstream vs defaultBaseBranch）
- [ ] CHK034 FR-034: upstream未設定時の表示仕様が明確

## セッション要約タブ

- [ ] CHK040 FR-040: セッション要約タブでエージェントセッションのAI要約が表示される
- [ ] CHK041 FR-041: 表示形式（タスク/進捗、短文要約、バレットポイント、メトリクス）が明確
- [ ] CHK042 FR-042: AI設定無効時の設定促進メッセージが明確
- [ ] CHK043 FR-043: セッション不在時の「No session」表示が明確
- [ ] CHK044 FR-044: ローディングスピナー表示のタイミングが明確
- [ ] CHK045 FR-045: メモリキャッシュの有効範囲（セッション中）が明確

## タブ切り替え機能

- [ ] CHK070 FR-070: Tabキーでタブ切り替えが動作する
- [ ] CHK071 FR-071: ブランチ詳細タブのタイトル形式`[branch_name] Details`が明確
- [ ] CHK072 FR-072: セッション要約タブのタイトル形式`[branch_name] Session`が明確
- [ ] CHK073 FR-073: ブランチ切り替え時のタブ状態維持が明確
- [ ] CHK074 FR-074: 初期状態がブランチ詳細タブであることが明確

## セッションパーサー

- [ ] CHK080 FR-080: gwtのsession_idでエージェントセッションを特定する方法が明確
- [ ] CHK081 FR-081: Claude Codeのセッションファイル解析要件が明確
- [ ] CHK082 FR-082: Codex CLIのセッションファイル解析要件が明確
- [ ] CHK083 FR-083: Gemini CLIのセッションファイル解析要件が明確
- [ ] CHK084 FR-084: OpenCodeのセッションファイル解析要件が明確
- [ ] CHK085 FR-085: 会話履歴とツール実行履歴の抽出方法が明確
- [ ] CHK086 FR-086: 動的サンプリング（1000ターン以上）の動作が明確
- [ ] CHK087 FR-087: SessionParserトレイトと各エージェント別実装が明確

## ポーリング更新

- [ ] CHK090 FR-090: 30秒間隔のポーリングが明確
- [ ] CHK091 FR-091: セッションファイル変更検出時の自動再生成が明確
- [ ] CHK092 FR-092: ポーリングエラー時のキャッシュ表示継続が明確
- [ ] CHK093 FR-093: セッション要約タブ非表示時のポーリング停止が明確

## AI設定（プロファイル連携）

- [ ] CHK050 FR-050: プロファイルへの設定項目追加がSPEC既存形式と整合
- [ ] CHK051 FR-051: OpenAI互換APIの定義（エンドポイント、認証、レスポンス形式）が明確
- [ ] CHK052 FR-052: 環境変数フォールバックの優先順位が明確
- [ ] CHK053 FR-053: デフォルトエンドポイント`https://api.openai.com/v1`が適切

## データ取得

- [ ] CHK060 FR-060: バックグラウンド取得がUIブロッキングを防止する実装方法が明確
- [ ] CHK061 FR-061: ローディング表示のASCIIスピナー形式が既存と統一
- [ ] CHK062 FR-062: `(Failed to load)`表示時のリトライ方法が検討されている
- [ ] CHK063 FR-063: Worktreeなしブランチでのコミットログのみ表示が明確

## エッジケース網羅性

- [ ] CHK100 Worktreeなしブランチの振る舞いが全セクションで定義されている
- [ ] CHK101 コミットなしブランチの振る舞いが定義されている
- [ ] CHK102 detached HEAD状態の振る舞いが定義されている
- [ ] CHK103 リモートブランチ選択時の振る舞いが定義されている
- [ ] CHK104 データ取得失敗時のフォールバックが定義されている
- [ ] CHK105 ターミナルサイズ制約時の振る舞いが定義されている
- [ ] CHK106 セッションファイルが巨大な場合の振る舞いが定義されている
- [ ] CHK107 セッションファイルが破損した場合の振る舞いが定義されている
- [ ] CHK108 エージェント作業中のセッションファイル更新の振る舞いが定義されている
- [ ] CHK109 長いセッション（1000ターン以上）の動的サンプリングが定義されている

## 成功基準の測定可能性

- [ ] CHK110 SC-001: 200ms応答時間が自動テストで測定可能
- [ ] CHK111 SC-002: 500msコミットログ表示開始が測定可能
- [ ] CHK112 SC-003: 安全性判定との同時表示が検証可能
- [ ] CHK113 SC-004: 100msキャッシュ済みセッション要約表示が測定可能
- [ ] CHK114 SC-005: スクロール滑らかさの定義と測定方法が明確
- [ ] CHK115 SC-006: APIエラー時の他セクション表示継続が検証可能
- [ ] CHK116 SC-007: 80%ユーザー理解度の測定方法が検討されている
- [ ] CHK117 SC-008: 50msタブ切り替え完了が測定可能
- [ ] CHK118 SC-009: 30秒ポーリング精度（±5秒）が測定可能
- [ ] CHK119 SC-010: 全4エージェント解析が検証可能
- [ ] CHK120 SC-011: 1000ターン以上のセッションで3秒以内の要約生成が測定可能

## 注記

- 完了した項目にチェックマーク: `[x]`
- 不明点や要確認事項はインラインでコメント追加
- 関連SPECへの参照: SPEC-d2f4762a（ブランチ選択画面）
- 対応エージェント: Claude Code, Codex CLI, Gemini CLI, OpenCode
