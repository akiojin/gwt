# ログ運用統一仕様

**作成日**: 2025-12-11

## 背景
- 画面に表示するメッセージと、永続的に保管するログの区別が曖昧だった。
- 構造化ログの出力方式が機能ごとにばらついているため、ツール全体で統一する。

## 定義
- **画面出力**: 標準出力・標準エラーに表示されるメッセージ。ログとは呼ばない。
- **ログ**: ファイルに書き出す永続的な記録。構造化（JSON）形式とする。

## 必須要件
1. **ロガー実装**: ログ出力は pino を用いること（構造化ログ, JSON）。
2. **出力先**: ログはファイルへ書き出すこと（画面出力と混在させない）。コンポーネント別にファイルを分けず、1系統のログに「category」フィールドで区別する。
3. **配置規則**: 出力パスは固定で `~/.gwt/logs/<カレントディレクトリ名>/<YYYY-MM-DD>.jsonl` とする（環境変数によるパス上書きは行わない）。サブディレクトリが存在しない場合は自動作成する。
4. **区別**: 画面出力で「ログ」「log」という語を使わず、ガイダンス/通知など適切な文言にすること。
5. **共通フォーマット**: タイムスタンプ・level・message を必須フィールドとし、追加フィールドはオブジェクトで付与する。
6. **ローテーション**: ログファイルは 7 日間でローテーション（保持）し、1 日あたりのサイズ上限は設けない。ローテーションは起動時に `keepDays` を超えるファイルを削除して実現する。
7. **TDD**: ログ機能を追加・変更する際は、先にテストを作成（Red）し、仕様遵守を検証する。最低限以下を自動テストで担保すること:
   - JSON構造（必須フィールド: timestamp/level/message/category）が出力される。
   - category が指定値で出力される。
   - ローテーション処理が起動時に7日超のファイルを削除する。

## 非機能
- 機能追加に伴うパフォーマンス劣化を最小化する（pino 標準設定を基本とする）。
- PII/シークレットは既存仕様に従いマスクする。

## 対象範囲
- gwt CLI / Web UI / サーバーコンポーネントの全ログ。

## 移行ガイド
- 既存の console ベースのログ出力は、画面出力とログファイル出力に役割分担する。
- 段階的移行を許容するが、新規機能は本仕様に従うこと。
