# 機能仕様: Codex CLI gpt-5.2-codex 対応

**仕様ID**: `SPEC-96e694b4`
**作成日**: 2025-12-18
**ステータス**: ドラフト
**入力**: ユーザー説明: "gpt-5.2-codexがリリースされましたので、対応して下さい。これもExtra Highに対応しています。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - gpt-5.2-codex を選択して起動 (優先度: P1)

開発者がモデル選択画面で gpt-5.2-codex を選ぶと、Codex CLI に gpt-5.2-codex が渡され、推論レベルに Extra high が選択できる。

**この優先度の理由**: 新モデルの価値を最短で体験できることがアップデート対応の主目的である。

**独立したテスト**: Codex のモデル一覧に gpt-5.2-codex が含まれ、推論レベルに Extra high が含まれることをユニットテストで確認できる。

**受け入れシナリオ**:

1. **前提条件** Codex のモデル選択画面を開く、**操作** モデル一覧を確認、**期待結果** gpt-5.2-codex が表示される
2. **前提条件** gpt-5.2-codex を選択、**操作** 推論レベル選択を開く、**期待結果** Extra high を選択できる
3. **前提条件** gpt-5.2-codex を選択して起動、**操作** Codex CLI を起動、**期待結果** `--model` に gpt-5.2-codex が渡される

---

### ユーザーストーリー 2 - デフォルト起動で gpt-5.2-codex を使用 (優先度: P1)

開発者が追加設定なしで Codex CLI を起動したとき、既定モデルが gpt-5.2-codex になり最新のコーディングモデルをすぐ利用できる。

**この優先度の理由**: デフォルトの更新は多くのユーザーに影響し、最新モデルに追随できることが重要である。

**独立したテスト**: デフォルト起動時の引数に gpt-5.2-codex が含まれることをユニットテストで確認できる。

**受け入れシナリオ**:

1. **前提条件** モデル指定なし、**操作** Codex CLI を起動、**期待結果** 既定の `--model` が gpt-5.2-codex になる
2. **前提条件** Web UI の起動コマンドプレビューを確認、**操作** Codex のデフォルト引数を確認、**期待結果** gpt-5.2-codex が含まれる

---

### ユーザーストーリー 3 - モデル一覧を4種類に限定し最新優先にする (優先度: P2)

開発者がモデル一覧を見たとき、表示モデルが4種類に限定され、最新の gpt-5.2-codex が先頭付近に配置されるため、迷わず選択できる。

**この優先度の理由**: モデル数が増えるほど誤選択が起きやすく、並び順がユーザビリティに直結する。

**独立したテスト**: モデル一覧が4件であることと並び順をユニットテストで確認できる。

**受け入れシナリオ**:

1. **前提条件** Codex のモデル一覧を取得、**操作** 件数と並び順を確認、**期待結果** 4件のみで gpt-5.2-codex が先頭付近に並ぶ

### エッジケース

- gpt-5.2-codex をサポートしない Codex CLI バージョンでも、既存のエラーメッセージを維持する
- Extra high を選択しない場合でも、既定推論レベルが維持される
- モデル一覧から除外したモデルは UI から選択できないが、必要に応じて `extraArgs` で上書きできる

## 要件 *(必須)*

### 機能要件

- **FR-001**: Codex のモデル選択肢に gpt-5.2-codex を追加し、推論レベルに Extra high を含めなければならない
- **FR-002**: gpt-5.2-codex を選択した場合、Codex CLI に `--model` として渡さなければならない
- **FR-003**: Codex のデフォルトモデルは gpt-5.2-codex として扱わなければならない
- **FR-004**: Codex のモデル一覧は4種類（gpt-5.2-codex、gpt-5.1-codex-max、gpt-5.1-codex-mini、gpt-5.2）に限定しなければならない
- **FR-005**: Codex のモデル一覧は最新モデル（gpt-5.2-codex）を優先した並び順を維持しなければならない

### 主要エンティティ

- **CodexModelOption**: Codex のモデル選択肢（モデルID、表示ラベル、説明、推論レベル、既定推論レベル）を保持する

## 成功基準 *(必須)*

- **SC-001**: Codex のモデル一覧テストが gpt-5.2-codex と Extra high を含む期待値で成功する
- **SC-002**: デフォルト起動の引数テストが gpt-5.2-codex を前提に成功する
- **SC-003**: UI のモデル選択テストが4件限定と gpt-5.2-codex の並び順を満たした状態で成功する

## 制約と仮定

### 制約

- Codex CLI の最新バージョンが gpt-5.2-codex を受け付けること
- 既存の起動フローや追加フラグの順序は変更しない

### 仮定

- 既存ユーザーは必要に応じて任意モデルを選択できる
- 既存の gpt-5.1 系モデルは UI から除外されるが、互換性維持のため `extraArgs` で指定可能とする

## 範囲外 *(必須)*

- gpt-5.1 系モデルを CLI 側で使用禁止にすること（UI からの除外のみ対象）
- 推論レベルの名称や既定値を全体で変更すること
- Codex CLI の機能追加やフラグ設計変更

## セキュリティとプライバシーの考慮事項

- 新モデル追加による権限スキップやサンドボックス設定の変更は行わない

## 依存関係

- @openai/codex のモデル提供（gpt-5.2-codex）
- 既存のモデル選択 UI と Codex 起動ロジック

## 参考資料

- [OpenAI Codex CLI ドキュメント](https://developers.openai.com/codex/cli/)
- [既存実装: src/codex.ts](../../src/codex.ts)
- [既存実装: src/cli/ui/utils/modelOptions.ts](../../src/cli/ui/utils/modelOptions.ts)
