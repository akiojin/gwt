# 機能仕様: Windows での外部プロセス実行時コンソール点滅抑止

**仕様ID**: `SPEC-8c6f4a21`  
**作成日**: 2026-02-13  
**更新日**: 2026-02-13  
**ステータス**: ドラフト  
**カテゴリ**: GUI  
**依存仕様**:

- [SPEC-a70a1ece](../archive/SPEC-a70a1ece/spec.md)

**入力**: ユーザー説明: "Windowsで動作が不安定なのを解消したい。何するたびに動作が固まる、Gitアクセス？しているせいか、ターミナルのようなウィンドウが頻繁に表示されて、すぐに消える。"

## 背景

- Windows GUI 実行時に外部コマンド子プロセス起動で一瞬コンソールが表示される場合があり、操作のたびにフリーズした体感を与える。
- `gwt-core`/`gwt-tauri` の外部コマンド実行経路が分散しており、Windows 固有の起動制御が統一されていない。

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - 操作時の点滅コンソールをなくしたい (優先度: P0)

Windows ユーザーとして、ブランチ一覧・差分表示・バージョン履歴・Docker連携・エージェント検出などの操作を行っても、点滅するコンソールウィンドウが出ない状態で作業を継続したい。

**独立したテスト**: Windows 実機で外部コマンドを伴う操作を連続実行し、点滅コンソールが出ないことを確認する。

**受け入れシナリオ**:

1. **前提条件** Windows で gwt GUI を起動済み、**操作** サイドバー更新・Git タブ更新を複数回行う、**期待結果** コンソールウィンドウが表示されない
2. **前提条件** Windows で bare/worktree 操作が可能なリポジトリ、**操作** worktree 作成/一覧/履歴表示を行う、**期待結果** コンソールウィンドウが表示されない
3. **前提条件** Docker/Agent関連コマンドが使える環境、**操作** Docker確認やエージェント検出を行う、**期待結果** コンソールウィンドウが表示されない

---

### ユーザーストーリー 2 - 既存機能を壊したくない (優先度: P1)

開発者として、点滅抑止の修正を入れても既存の外部コマンド利用機能が回帰しないことを担保したい。

**独立したテスト**: Rust テストが通過し、主要な Git 操作コマンド群が成功する。

**受け入れシナリオ**:

1. **前提条件** 開発環境でテスト実行可能、**操作** `cargo test` を実行、**期待結果** 既存テストが通過する
2. **前提条件** ソース改修後、**操作** 直接 `Command::new(...)` の混入チェックを実行、**期待結果** ワークスペース Rust コードに直接呼び出しが存在しない

## エッジケース

- Windows 以外では従来挙動を維持する（no-op）。
- ガードテスト自身（`crates/gwt-core/tests/no_direct_git_command.rs`）とヘルパー実装（`crates/gwt-core/src/process.rs`）は検査対象外とする。

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、`gwt-core`/`gwt-tauri` の本番ソースにおける外部コマンド実行を共通ヘルパー経由に統一しなければならない。
- **FR-002**: システムは、Windows で外部コマンド子プロセスを起動する際にコンソールを表示しない設定を適用しなければならない。
- **FR-003**: システムは、ワークスペース Rust コード（`crates/gwt-core/src|tests|benches`, `crates/gwt-tauri/src`）に直接の `Command::new(...)` / `tokio::process::Command::new(...)` が混入した場合にテストで検出できなければならない。
- **FR-004**: システムは、既存の外部コマンド利用機能（Git/Docker/Agent関連）を継続して実行できなければならない。

### 非機能要件

- **NFR-001**: 既存テストスイート (`cargo test`) で回帰が発生しないこと。
- **NFR-002**: 点滅抑止のための実装で Windows 以外の実行環境の機能劣化を発生させないこと。

## 制約と仮定

- 今回は「外部CLI依存を廃止する」範囲は含まない。対象は Windows 点滅抑止と実行経路統一。

## 成功基準 *(必須)*

- **SC-001**: `crates/gwt-core/src|tests|benches` と `crates/gwt-tauri/src` で `process.rs` とガードテスト自身を除き `Command::new(...)` / `tokio::process::Command::new(...)` が 0 件である。
- **SC-002**: `cargo check` と `cargo test` が成功する。
- **SC-003**: Windows 実機で外部コマンドを伴う操作中に点滅コンソールが再現しない。
