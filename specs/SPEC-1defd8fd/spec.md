# 機能仕様: bugfixブランチタイプのサポート追加

**仕様ID**: `SPEC-1defd8fd`
**作成日**: 2025-01-18
**ステータス**: ドラフト
**入力**: ユーザー説明: "bugfixブランチタイプのサポート追加"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - 通常のバグ修正用ブランチを作成できる (優先度: P1)

開発者が通常のバグ修正（緊急ではない）を行う際に、適切な名前とアイコンでブランチを作成・識別できる。hotfixは緊急バグ修正用として区別される。

**この優先度の理由**: バグ修正は日常的な開発作業の中核であり、緊急度に応じて適切に分類する必要がある。現在はfeature（新機能）かhotfix（緊急修正）しかなく、通常のバグ修正を表現できない。

**独立したテスト**: ブランチ作成UIでbugfixタイプを選択し、bugfix/プレフィックス付きブランチが作成され、🐛アイコンで表示されることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提条件** ユーザーがブランチ作成画面を開いている、**操作** ブランチタイプ選択肢を表示する、**期待結果** feature、bugfix、hotfix、releaseの4つの選択肢が表示される
2. **前提条件** ユーザーがbugfixタイプを選択した、**操作** ブランチ名「security-issue」を入力して作成、**期待結果** bugfix/security-issueブランチが作成される
3. **前提条件** bugfix/security-issueブランチが存在する、**操作** ブランチリストを表示する、**期待結果** 🐛アイコンとともにbugfix/security-issueが表示される

---

### ユーザーストーリー 2 - bug/プレフィックスもbugfixとして認識される (優先度: P2)

開発者がbug/プレフィックスでブランチを作成した場合も、bugfixブランチタイプとして認識され、同じアイコンで表示される。

**この優先度の理由**: 既存のプロジェクトではbug/プレフィックスを使用している可能性があり、後方互換性を確保することでスムーズな移行が可能になる。

**独立したテスト**: bug/プレフィックスのブランチを作成し、🐛アイコンで表示されることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提条件** bug/null-pointer-exceptionブランチが存在する、**操作** ブランチリストを表示する、**期待結果** 🐛アイコンとともに表示され、ブランチタイプがbugfixと判定される
2. **前提条件** getBranchType関数にbug/プレフィックスのブランチ名を渡す、**操作** ブランチタイプを判定する、**期待結果** "bugfix"が返される

---

### ユーザーストーリー 3 - 既存のfeature/hotfix/releaseと同等に扱われる (優先度: P1)

bugfixブランチタイプは、既存のブランチタイプ（feature、hotfix、release）と同じ方法で、ソート、フィルタリング、表示において扱われる。

**この優先度の理由**: 新しいブランチタイプが既存の機能と統合されていない場合、ユーザー体験が断片化し、混乱を招く。一貫性のある動作が必須。

**独立したテスト**: bugfixブランチを作成し、ブランチリスト、ソート、フィルタリング機能で正しく表示・処理されることで完全にテスト可能。

**受け入れシナリオ**:

1. **前提条件** feature、bugfix、hotfixブランチが混在している、**操作** ブランチリストをソートする、**期待結果** bugfixブランチも他のタイプと同じソートロジックで並べられる
2. **前提条件** ブランチタイプフィルターが存在する、**操作** フィルター選択肢を表示する、**期待結果** bugfixが選択肢に含まれる
3. **前提条件** bugfix/test-branchが選択されている、**操作** ブランチ情報を取得する、**期待結果** branchType: "bugfix"が正しく返される

---

### エッジケース

- 空のブランチ名でbugfixタイプを選択した場合、適切なバリデーションエラーが表示される
- bugfix/やbug/だけのブランチ名（スラッシュ後が空）は作成できない
- 既存のbugfix/同名ブランチがある場合、重複エラーが表示される
- 大文字小文字が混在したBugFix/やBUG/プレフィックスは認識されない（小文字のみサポート）

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムはBranchType型定義にbugfixを追加**しなければならない**
- **FR-002**: システムはBRANCH_TYPES定数にBUGFIX: "bugfix"を追加**しなければならない**
- **FR-003**: システムはBRANCH_PREFIXES定数にBUGFIX: "bugfix/"を追加**しなければならない**
- **FR-004**: システムはgetBranchType関数でbugfix/プレフィックスを判定し"bugfix"を返す**しなければならない**
- **FR-005**: システムはgetBranchType関数でbug/プレフィックスを判定し"bugfix"を返す**しなければならない**
- **FR-006**: システムはbugfixブランチタイプに🐛アイコンを割り当てる**しなければならない**
- **FR-007**: ユーザーはブランチ作成UI（BranchCreatorScreen）でbugfixタイプを選択でき**なければならない**
- **FR-008**: bugfixブランチタイプは"Bug fix"という説明文で表示され**なければならない**
- **FR-009**: システムはbugfixブランチをfeature/hotfix/releaseと同じソート・フィルタリングロジックで処理**しなければならない**
- **FR-010**: テストフィクスチャ（tests/fixtures/branches.ts）にbugfixブランチのサンプルを含める**しなければならない**

### 主要エンティティ

- **BranchType**: ブランチの種類を表す型。"feature" | "bugfix" | "hotfix" | "release" | "main" | "develop" | "other"のユニオン型
- **BranchInfo**: ブランチ情報を表すインターフェース。nameプロパティ、typeプロパティ（local/remote）、branchTypeプロパティ（BranchType）を持つ
- **BRANCH_PREFIXES**: ブランチ作成時に使用するプレフィックスの定数オブジェクト。FEATURE, BUGFIX, HOTFIX, RELEASEキーを持つ

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーはブランチ作成画面でbugfixタイプを選択し、30秒以内にbugfix/プレフィックス付きブランチを作成できる
- **SC-002**: システムはbugfix/およびbug/プレフィックスのブランチを100%正確にbugfixタイプとして判定できる
- **SC-003**: bugfixブランチは🐛アイコンで100%一貫して表示される
- **SC-004**: bugfixブランチタイプを追加しても、既存のfeature/hotfix/release機能に影響を与えない（既存テストが全てパスする）
- **SC-005**: 開発者の90%が初回でbugfixとhotfixの違い（緊急度）を理解できる（説明文: "Bug fix" vs "Critical bug fix"）

## 制約と仮定 *(該当する場合)*

### 制約

- 既存のBranchType型定義を破壊しない形で拡張する必要がある
- 既存のgetBranchType関数のロジックと一貫性を保つ必要がある（順序、パターンマッチング）
- TypeScript型システムによる静的検証を維持する必要がある

### 仮定

- ユーザーはbugfixとhotfixの違い（緊急度）を理解している、または説明文から推測できる
- bugfix/とbug/の両方のプレフィックスをサポートすることでユーザーの柔軟性が向上する
- 🐛アイコンはbugfixを直感的に表現できる普遍的なシンボルである
- 既存のブランチタイプ判定ロジック（src/git.tsとsrc/services/git.service.ts）は一貫性を保つために両方更新される

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- bugfix/プレフィックス以外のカスタムプレフィックス（fix/、patch/など）のサポート
- ブランチタイプ間の自動変換（例: featureからbugfixへの変更）
- ブランチタイプに基づくワークフロー自動化（例: bugfixブランチのみ特定のCIジョブを実行）
- ブランチタイプごとの権限管理
- ブランチタイプのユーザーカスタマイズ機能
- 国際化対応（アイコン、説明文の多言語対応）

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

このセクションは該当しません（ブランチタイプは識別情報であり、セキュリティ・プライバシーへの直接的影響はありません）。

## 依存関係 *(該当する場合)*

- **TypeScript型システム**: BranchType型定義の変更に依存
- **既存のブランチタイプ判定ロジック**: src/git.tsとsrc/services/git.service.tsのgetBranchType関数
- **UI コンポーネント**: BranchCreatorScreen.tsx、branchFormatter.ts
- **テストフレームワーク**: Vitest、Testing Library（テストケース追加のため）

## 参考資料 *(該当する場合)*

- [実装済みコミット - ca915a0](https://github.com/akiojin/gwt/commit/ca915a0)
- [既存のブランチタイプ定義](../../src/cli/ui/types.ts)
- [ブランチ判定ロジック](../../src/git.ts)
