# 機能仕様: HuskyでCIと同等のLintを実行

**仕様ID**: `SPEC-6408df0c`
**作成日**: 2026-01-19
**ステータス**: ドラフト
**入力**: ユーザー説明: "CIと同じLintはHuskyで対応しておくべき。"

## ユーザーシナリオとテスト *(必須)*

<!--
  重要: ユーザーストーリーは重要度順に優先順位付けする必要があります。
  各ユーザーストーリー/ジャーニーは独立してテスト可能である必要があります。
  つまり、1つだけ実装しても、価値を提供する実行可能なMVP（Minimum Viable Product）が得られる必要があります。

  各ストーリーに優先度（P1、P2、P3など）を割り当てます。P1が最も重要です。
  各ストーリーを、独立して以下が可能な機能のスライスとして考えてください：
  - 独立した開発
  - 独立したテスト
  - 独立したデプロイ
  - ユーザーへの独立したデモンストレーション
-->

### ユーザーストーリー 1 - pre-pushでCI同等のLintを自動実行 (優先度: P1)

開発者がpush前にCIと同じLintが自動実行され、失敗をローカルで検知できる。

**この優先度の理由**: CI失敗の手戻りを減らすため最優先。

**独立したテスト**: pre-pushフックを実行し、Lint失敗時にブロック/成功時に通過することを確認する。

**受け入れシナリオ**:

1. **前提条件** Huskyが有効、**操作** `git push` を実行、**期待結果** CIと同等のLintが実行される
2. **前提条件** Lintが失敗する変更が含まれる、**操作** `git push`、**期待結果** pushが失敗し英語のエラーが表示される
3. **前提条件** Lintが成功する変更、**操作** `git push`、**期待結果** pushが継続される

---

### ユーザーストーリー 2 - Huskyの自動セットアップ (優先度: P2)

開発者が依存関係をインストールすると、Huskyフックが自動でセットアップされる。

**この優先度の理由**: セットアップ漏れを防止するため。

**独立したテスト**: インストール後にフックが配置されていることを確認する。

**受け入れシナリオ**:

1. **前提条件** 依存関係が未インストール、**操作** 依存関係をインストール、**期待結果** Huskyフックが有効化される

---

### ユーザーストーリー 3 - 失敗時に明確な英語エラー (優先度: P3)

開発者がLint失敗に遭遇したとき、英語のエラーメッセージで原因を理解できる。

**この優先度の理由**: 即時の自己修正を可能にするため。

**独立したテスト**: 失敗ケースのメッセージを検証する。

**受け入れシナリオ**:

1. **前提条件** Lintが失敗する変更がある、**操作** `git push`、**期待結果** 失敗理由が英語で表示される

---

[必要に応じて、優先度を割り当てた追加のユーザーストーリーを追加]

### エッジケース

- **環境不足**: Node/BunやRustツールチェーンがない場合、フックは明示的に失敗し理由を表示する
- **実行時間**: フックが極端に長時間かかる場合、許容時間や運用方針を定める（要確認）

## 要件 *(必須)*

<!--
  対応必要: このセクションの内容はプレースホルダーです。
  適切な機能要件を記入してください。
-->

### 機能要件

- **FR-001**: システムはHuskyを導入し、フックを有効化**しなければならない**
- **FR-002**: システムはCIと同等のLintコマンド（clippy、fmt、markdownlint）をpre-pushフックで実行**しなければならない**
- **FR-003**: システムは`bunx husky`を用いてフックをセットアップ**しなければならない**
- **FR-004**: システムはLint失敗時にpushを失敗させ、英語のエラーを表示**しなければならない**
- **FR-005**: システムはLintのスキップ手段を提供**してはならない**
- **FR-006**: システムは依存関係インストール時にフックが自動設定される**べきである**
- **FR-007**: システムはHuskyフックの設定内容を自動テストで検証**しなければならない**

## 成功基準 *(必須)*

<!--
  対応必要: 測定可能な成功基準を定義してください。
  これらは技術に依存せず、測定可能である必要があります。
-->

### 測定可能な成果

- **SC-001**: フックで実行されるLintがCIと同一であることが明文化されている
- **SC-002**: Lint失敗がローカルで検知され、CI失敗率が低下する

## 制約と仮定 *(該当する場合)*

<!--
  対応必要: 技術的制約、ビジネス制約、または重要な仮定を記載してください。
-->

### 制約

- 既存のRust/Bun/Nodeのツールチェーンを使用する
- フックのエラーメッセージは英語で表示する
- 実行タイミングはpre-pushに固定する

### 仮定

- 開発者環境にNodeまたはBunが存在する
- Gitフックを実行できる環境である

## 範囲外 *(必須)*

<!--
  対応必要: この機能の範囲外であることを明確にしてください。
-->

次の項目は、この機能の範囲外です：

- Lintコマンド自体の見直し
- CIワークフローの変更
- lint対象ファイルの個別最適化（lint-stagedなど）
- 追加のドキュメント整備

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- 追加の機密情報は扱わない

## 依存関係 *(該当する場合)*

- Node/Bun
- Husky

## 参考資料 *(該当する場合)*

- [Husky Documentation](https://typicode.github.io/husky)
