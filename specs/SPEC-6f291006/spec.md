# 機能仕様: Migration backup copy の Windows 互換修正

**仕様ID**: `SPEC-6f291006`
**作成日**: 2026-02-13
**ステータス**: 実装完了
**カテゴリ**: Core / Migration
**入力**: GitHub Issue #1006 "マイグレーション時にエラー"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - Windowsでマイグレーションを完了したい (優先度: P0)

Windowsユーザーとして、通常リポジトリからbare形式への移行時にバックアップ作成が失敗せず完了してほしい。

**独立したテスト**: `cp` コマンドが利用できない環境でも `create_backup()` が成功することを確認する。

**受け入れシナリオ**:

1. **前提条件** バックアップ対象に `.git` が存在する、**操作** マイグレーション開始、**期待結果** バックアップフェーズが `program not found` で失敗しない
2. **前提条件** 既存バックアップがある、**操作** `restore_backup()` 実行、**期待結果** `.git` が復元される

### エッジケース

- `cp` が `PATH` 上に存在しない環境（Windows / 最小Unix環境）
- `.git`, `.worktrees`, `.gwt` のうち存在するディレクトリのみコピーする

## 要件 *(必須)*

### 機能要件

- **FR-1006-01**: システムは、`cp` コマンド非依存でバックアップ用ディレクトリコピーを実行できなければならない
- **FR-1006-02**: システムは、`cp` 実行が失敗または未検出でも、標準APIによる再帰コピーでバックアップを継続しなければならない
- **FR-1006-03**: システムは、既存の `create_backup()` / `restore_backup()` の入出力契約を変更してはならない

### 非機能要件

- **NFR-1006-01**: 既存のUnix動作を壊さず、Windowsで同等の成功率を確保する

## 成功基準 *(必須)*

- **SC-1006-01**: Windows環境で Issue #1006 の再現エラー（`program not found`）が発生しない
- **SC-1006-02**: `cp` 非存在を模擬したテストがパスする

## 範囲外 *(必須)*

- マイグレーション全体フローのUI変更
- バックアップ対象ディレクトリの追加/削除
