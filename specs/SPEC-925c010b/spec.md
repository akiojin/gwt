# 機能仕様: Docker Compose の Playwright noVNC を arm64 で起動可能にする

**仕様ID**: `[SPEC-925c010b]`
**作成日**: 2026-01-17
**ステータス**: ドラフト
**入力**: ユーザー説明: "docker compose up -d で playwright-novnc が arm64 だと no matching manifest になる"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - arm64 でも docker compose が完走する (優先度: P1)

arm64 環境の開発者として、docker compose up -d を実行しても playwright-novnc が manifest 不一致で失敗せず、Docker 環境を利用できる。

**この優先度の理由**: arm64 環境では現状起動できず、Docker 開発フローが利用できないため。

**独立したテスト**: arm64 環境で docker compose up -d を実行し、playwright-novnc の pull/起動がエラー無く進むことで検証できる。

**受け入れシナリオ**:

1. **前提条件** arm64 環境、**操作** docker compose up -d、**期待結果** no matching manifest エラーが発生しない
2. **前提条件** arm64 環境で platform 指定を上書き、**操作** docker compose up -d、**期待結果** 指定した platform が適用される

---

### ユーザーストーリー 2 - 既存の amd64 利用は影響を受けない (優先度: P2)

amd64 環境の開発者として、変更後も既存の Docker 構成が同じ手順で起動できる。

**この優先度の理由**: 既存ユーザーの回帰を避ける必要があるため。

**独立したテスト**: amd64 環境で docker compose up -d を実行し、同一の動作で起動できることを確認する。

**受け入れシナリオ**:

1. **前提条件** amd64 環境、**操作** docker compose up -d、**期待結果** 既存と同じ手順で起動できる

---

### ユーザーストーリー 3 - arm64 向けの手順が分かる (優先度: P3)

arm64 環境の開発者として、必要な platform 設定や注意点がドキュメントで分かる。

**この優先度の理由**: 設定が分からないと再発し、再現・自己解決できないため。

**独立したテスト**: ドキュメントの手順を読むだけで、platform 指定の方法と注意点が理解できる。

**受け入れシナリオ**:

1. **前提条件** ドキュメントを閲覧、**操作** arm64 向けの項目を読む、**期待結果** platform の指定方法と前提条件が明記されている

---

### ユーザーストーリー 4 - Linux でも host.docker.internal が使える (優先度: P2)

Linux 環境の開発者として、コンテナからホストOSへアクセスするため `host.docker.internal` が解決できる。

**この優先度の理由**: ホスト側サービスに接続できないと開発が進まないため。

**独立したテスト**: Linux 環境で gwt コンテナから `host.docker.internal` の名前解決が行えることを確認できる。

**受け入れシナリオ**:

1. **前提条件** Linux 環境、**操作** gwt コンテナ内から `host.docker.internal` を解決、**期待結果** ホストへ接続できる

---

### エッジケース

- arm64 で amd64 を指定したがエミュレーションが無効な場合、実行時の失敗と対処方法が記載される
- platform の環境変数が無効な値の場合、既定値に戻るか、明確な手順が示される

## 要件 *(必須)*

### 機能要件

- **FR-001**: docker compose の playwright-novnc サービスは platform を環境変数で上書きでき**なければならない**
- **FR-002**: platform の既定値は linux/amd64 と**しなければならない**
- **FR-003**: 既存の amd64 環境での手順は変更せず**維持しなければならない**
- **FR-004**: arm64 向けの注意点と設定手順をドキュメントに**記載しなければならない**
- **FR-005**: gwt サービスは `host.docker.internal` をホストへ解決でき**なければならない**

### 主要エンティティ *(機能がデータを含む場合は含める)*

- なし（設定変更のみ）

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: arm64 環境で docker compose up -d を実行した際に no matching manifest エラーが発生しない
- **SC-002**: amd64 環境で docker compose up -d を実行し、従来どおり起動できる
- **SC-003**: ドキュメントに platform の指定方法と前提条件が明記されている
- **SC-004**: Linux 環境で `host.docker.internal` がホストへ解決できる

## 制約と仮定 *(該当する場合)*

### 制約

- 既存の Playwright noVNC イメージは変更しない
- 新たな外部依存は追加しない

### 仮定

- arm64 環境で amd64 を実行する場合、Docker がエミュレーションを利用できる

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- Playwright noVNC イメージの再構築やマルチアーキ対応
- gwt サービスの Dockerfile の再設計

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- 新しい秘密情報の取り扱いは発生しない

## 依存関係 *(該当する場合)*

- なし

## 参考資料 *(該当する場合)*

- [Docker環境での利用](../../docs/docker-usage.md)
