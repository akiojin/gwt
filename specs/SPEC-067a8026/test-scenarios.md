# テストシナリオ: LLMベースリリースワークフロー

**仕様ID**: `SPEC-067a8026`
**作成日**: 2026-01-21

## 概要

このドキュメントはLLMスキル（`/release`）の動作を検証するためのテストシナリオを定義する。
Claude Codeスキルはユニットテストで検証できないため、手動検証シナリオとして記述する。

---

## テストシナリオ一覧

### TS-001: 正常系 - 基本リリースフロー

**前提条件**:
- developブランチにチェックアウト
- 前回タグ以降に`feat:`または`fix:`コミットがある
- mainとdevelopが同期済み
- 既存Release PRがない

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] git-cliffでバージョンが判定される（ログに表示）
- [ ] Cargo.toml（ルート）のバージョンが更新される
- [ ] crates/gwt-cli/Cargo.tomlのバージョンが更新される
- [ ] crates/gwt-core/Cargo.tomlのバージョンが更新される
- [ ] package.jsonのバージョンが更新される
- [ ] Cargo.lockが更新される
- [ ] CHANGELOG.mdの先頭に新しいリリース分が追加される
- [ ] `chore(release): vX.Y.Z`形式でコミットが作成される
- [ ] developにプッシュされる
- [ ] develop→mainのPRが`release`ラベル付きで作成される

**検証コマンド**:
```bash
# バージョン確認
grep -m1 '^version = ' Cargo.toml
grep -m1 '^version = ' crates/gwt-cli/Cargo.toml
jq '.version' package.json

# コミット確認
git log -1 --oneline

# PR確認
gh pr list --base main --head develop
```

---

### TS-002: 異常系 - develop以外のブランチ

**前提条件**:
- featureブランチにチェックアウト

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] 「developブランチでのみ実行可能です」というエラーメッセージが表示される
- [ ] 処理が中断される
- [ ] ファイル変更がない

**検証コマンド**:
```bash
git status  # 変更なし
```

---

### TS-003: 異常系 - mainとdevelopに差異

**前提条件**:
- developブランチにチェックアウト
- mainにdevelopにマージされていないコミットがある

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] 「mainとdevelopに差異があります」というエラーメッセージが表示される
- [ ] 処理が中断される

**検証コマンド**:
```bash
git log origin/main..origin/develop --oneline  # 差異を確認
```

---

### TS-004: 異常系 - 既存リリースコミット

**前提条件**:
- developブランチにチェックアウト
- HEADが`chore(release): v1.2.3`形式のコミット

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] 「既にリリースコミットが存在します」というエラーメッセージが表示される
- [ ] 処理が中断される

---

### TS-005: 正常系 - chore/docsのみでパッチリリース

**前提条件**:
- developブランチにチェックアウト
- 前回タグ以降に`chore:`や`docs:`コミットのみ（feat/fixなし）

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] パッチバージョンとして処理が続行される（v1.2.3→v1.2.4）
- [ ] PRが作成される

---

### TS-006: 異常系 - リリース対象コミットなし

**前提条件**:
- developブランチにチェックアウト
- 前回タグ以降にコミットがない

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] 「リリース対象のコミットがありません」というエラーメッセージが表示される
- [ ] 処理が中断される

---

### TS-007: 正常系 - 既存PR更新

**前提条件**:
- developブランチにチェックアウト
- develop→mainのPRが既に存在

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] 新しいPRは作成されない
- [ ] developへのプッシュにより既存PRの内容が更新される
- [ ] ログに「既存のRelease PRを更新しました」と表示される

**検証コマンド**:
```bash
gh pr list --base main --head develop  # PR数が増えていない
```

---

### TS-008: 正常系 - minorバージョンアップ

**前提条件**:
- developブランチにチェックアウト
- 前回タグ以降に`feat:`コミットがある

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] minorバージョンがインクリメントされる（v1.2.3→v1.3.0）

---

### TS-009: 正常系 - majorバージョンアップ

**前提条件**:
- developブランチにチェックアウト
- 前回タグ以降に`feat!:`または`BREAKING CHANGE:`コミットがある

**実行手順**:
1. `/release`を実行

**期待結果**:
- [ ] majorバージョンがインクリメントされる（v1.2.3→v2.0.0）

---

### TS-010: 異常系 - push失敗時のリトライ

**前提条件**:
- developブランチにチェックアウト
- ネットワークが不安定（シミュレート）

**実行手順**:
1. `/release`を実行
2. pushが一時的に失敗

**期待結果**:
- [ ] リトライが行われる（最大3回）
- [ ] リトライ中のログが表示される

---

## git-cliff設定検証

### TS-GC-001: バージョン判定確認

**実行コマンド**:
```bash
git-cliff --bumped-version
```

**期待結果**:
- [ ] 正しいバージョンが出力される

---

### TS-GC-002: CHANGELOG生成確認

**実行コマンド**:
```bash
git-cliff --unreleased
```

**期待結果**:
- [ ] 今回リリース分のCHANGELOGが生成される
- [ ] feat/fix/choreなどが適切にカテゴリ分けされる

---

## CI互換性検証

### TS-CI-001: release.ymlトリガー確認

**前提条件**:
- `/release`でPRを作成・マージ済み

**期待結果**:
- [ ] `release.yml`がトリガーされる
- [ ] タグが作成される
- [ ] GitHub Releaseが作成される
- [ ] バイナリがビルド・アップロードされる
- [ ] npmに公開される

---

## チェックリスト

実装完了時に以下をすべて確認:

- [ ] TS-001: 正常系 - 基本リリースフロー
- [ ] TS-002: 異常系 - develop以外のブランチ
- [ ] TS-003: 異常系 - mainとdevelopに差異
- [ ] TS-004: 異常系 - 既存リリースコミット
- [ ] TS-005: 正常系 - chore/docsのみでパッチリリース
- [ ] TS-006: 異常系 - リリース対象コミットなし
- [ ] TS-007: 正常系 - 既存PR更新
- [ ] TS-008: 正常系 - minorバージョンアップ
- [ ] TS-009: 正常系 - majorバージョンアップ
- [ ] TS-010: 異常系 - push失敗時のリトライ
- [ ] TS-GC-001: バージョン判定確認
- [ ] TS-GC-002: CHANGELOG生成確認
- [ ] TS-CI-001: release.ymlトリガー確認
