# 機能仕様: Web UI機能の追加

**仕様ID**: `SPEC-d5e56259`
**作成日**: 2025-11-10
**ステータス**: ドラフト
**入力**: ユーザー説明: "Web UI機能の追加 - claude-worktree serveコマンドでWebサーバーを起動し、ブラウザからWorktree管理とAI Tool起動を行えるようにする"

## チャネルパリティ方針

- CLAUDE Worktree の機能は **CLI** / **Web UI** の双方で同等の価値を提供する前提で設計し、特記がない限り本仕様の要件は両チャネルに適用する。
- 受け入れシナリオ・機能要件では `(CLI)` / `(Web)` と明示してチャネル固有の期待値を記載する。
- 表示方法の差異（Ink UI vs React）は許容しつつ、Worktree 作成/削除、PR クリーンアップ、AI ツール起動、安全確認といったコア体験はチャネル間で一致させる。

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - Webサーバーの起動とアクセス (優先度: P1)

開発者は`claude-worktree serve`コマンドを実行してローカルでWebサーバーを起動し、ブラウザから`http://localhost:3000`にアクセスしてWorktree管理画面を表示できる。

**この優先度の理由**: Web UIの基盤となる機能であり、すべての後続機能の前提条件。サーバーが起動しなければ他の機能は使用できない。

**独立したテスト**: `claude-worktree serve`を実行してブラウザでアクセスし、正常にページが表示されることで完全にテストでき、CLIを使わずにブラウザからアクセスできるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件** ターミナルでclaude-worktreeがインストール済み、**操作** `claude-worktree serve`を実行、**期待結果** "Server running at <http://localhost:3000>"のようなメッセージが表示され、サーバーが起動する
2. **前提条件** Webサーバーが起動中、**操作** ブラウザで `<http://localhost:3000>` にアクセス、**期待結果** Worktree管理のWebインターフェースが表示される
3. **前提条件** Webサーバーが起動中、**操作** `Ctrl+C`でサーバーを停止、**期待結果** サーバーが正常にシャットダウンし、ブラウザからアクセスできなくなる

---

### ユーザーストーリー 2 - ブランチ一覧の表示とWorktree作成 (優先度: P1)

開発者は CLI / Web UI いずれからでもブランチ一覧を確認し、選択したブランチの Worktree を安全に作成できる。

**この優先度の理由**: Worktree管理の核心機能であり、CLIの主要機能をWeb UIで実現する最重要機能。ユーザーはマウス操作で直感的にWorktreeを作成できるようになる。

**独立したテスト**: ブラウザからブランチリストを表示し、任意のブランチリンクをクリックして詳細ページに遷移し、Worktreeを作成することで完全にテストでき、CLIコマンドを覚えずに視覚的に操作できるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件 (CLI)** Ink UI が起動、**操作** ブランチ一覧で対象ブランチを選択して `Enter`、**期待結果** Worktree 作成確認が表示され完了後にパスが出力される
2. **前提条件 (Web)** `/` にアクセス、**操作** ブランチリンクをクリック、**期待結果** 詳細ページ（`/:branchName`）に遷移しメタ情報と Worktree 状態を表示
3. **前提条件** Worktree 未作成、**操作** CLI の `Create Worktree` / Web の「Worktreeを作成」、**期待結果** 成功メッセージと新パスが両チャネルに表示される
4. **前提条件** 既存 Worktree あり、**操作** 同じフローを再実行、**期待結果** CLI / Web 共に「既に存在」警告と既存パスを提示し処理を中断する
5. **前提条件** ブランチ数が多い、**操作** CLI のフィルター入力 or Web の検索ボックス、**期待結果** 入力にマッチしたブランチのみがリアルタイム表示される

---

### ユーザーストーリー 3 - ブラウザからAI Toolの起動とリアルタイム出力表示 (優先度: P1)

開発者はブランチ詳細ページからAI Tool (Claude Code/Codex CLI) を選択して起動し、ターミナル風の画面でリアルタイムに出力を確認し、キーボード入力でインタラクティブに操作できる。

**この優先度の理由**: Web UIの最大の価値であるAI Toolとの統合。ブラウザからターミナル操作を行うことで、リモート環境での作業やタブ管理が容易になる。

**独立したテスト**: ブラウザからClaude Codeを起動し、ターミナル画面でリアルタイムな出力と入力が動作することで完全にテストでき、ブラウザでターミナル操作ができるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件** Worktreeが作成済み、**操作** ブランチ詳細ページ（`/:branchName`）で「AI Toolを起動」ボタンをクリック、**期待結果** AI Tool選択画面が表示される（Claude Code、Codex CLI、Custom Tool）
2. **前提条件** AI Tool選択画面、**操作** Claude Codeを選択し、モード（normal/continue/resume）を選択して起動、**期待結果** ブラウザ内にターミナル画面が表示され、Claude Codeの起動ログがリアルタイムで表示される
3. **前提条件** Claude Codeが起動中、**操作** ターミナル画面でキーボード入力（例: プロンプト入力）、**期待結果** 入力がClaude Codeに送信され、応答がリアルタイムで表示される
4. **前提条件** Claude Codeが起動中、**操作** ターミナルのサイズを変更、**期待結果** ターミナルが新しいサイズに適応し、表示が再調整される
5. **前提条件** Claude Codeが実行中、**操作** ブラウザタブを閉じる、**期待結果** バックグラウンドでセッションが継続し、再接続時に出力履歴が表示される

---

### ユーザーストーリー 4 - Worktreeの削除と管理 (優先度: P1)

開発者は CLI / Web UI で Worktree 一覧を確認し、不要な Worktree を削除し、マージ済み PR を一括クリーンアップできる。

**この優先度の理由**: Worktreeのライフサイクル管理機能。作成だけでなく削除も可能にすることで、ディスク容量の管理が容易になる。

**独立したテスト**: Worktree管理画面から既存のWorktreeを選択して削除し、ファイルシステムから削除されることで完全にテストでき、不要なWorktreeを簡単に整理できるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件 (CLI)** Worktree が複数存在、**操作** Worktreeビューで対象を選択、**期待結果** ブランチ名・パス・PR情報が表示される
2. **前提条件 (Web)** Worktree 管理ページ、**操作** 任意 Worktree の「削除」ボタン、**期待結果** 確認ダイアログ後に削除され CLI 側一覧にも同期される
3. **前提条件** マージ済み PR Worktree、**操作** CLI の `Cleanup merged PRs` / Web の「マージ済みPRのクリーンアップ」、**期待結果** 同じ候補が提示され選択結果が一致する
4. **前提条件** 保護ブランチ Worktree、**操作** 削除操作、**期待結果** CLI/Web 共に警告を表示し既定ルールに従って中断する

---

### ユーザーストーリー 5 - カスタムAI Toolの設定管理と起動 (優先度: P2)

開発者は CLI / Web UI の設定画面から `~/.claude-worktree/tools.json` を編集し、カスタムAI Toolを追加・削除・変更し、登録済みツールを両チャネルから起動できる。

**この優先度の理由**: 拡張性を提供する機能。ユーザーが独自のAI Toolを登録できることで、claude-worktreeの用途が広がる。

**独立したテスト**: 設定管理画面からカスタムツールを追加し、保存後にAI Tool選択画面で新しいツールが表示されることで完全にテストでき、JSONファイルを直接編集せずにGUIで設定できるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件 (Web)** 設定画面にアクセス、**期待結果** CLI と同じ `tools.json` 内容が一覧表示される
2. **前提条件 (CLI)** Custom Tools メニュー、**操作** 新規追加フォームで ID / command / modeArgs を入力、**期待結果** 保存後に Web UI にも即反映される
3. **前提条件** カスタムツール登録済み、**操作** CLI / Web からツールを選択して起動、**期待結果** resolver が type (`path`/`bunx`/`command`) と modeArgs を適用して実行する
4. **前提条件** 不正 JSON、**操作** 保存を試行、**期待結果** CLI / Web 共にバリデーションエラーを表示し `tools.json` を更新しない

---

### ユーザーストーリー 6 - Git操作のビジュアル化 (優先度: P3)

開発者はブラウザでブランチツリーを視覚的に確認し、各ブランチのマージ状態や差分を視覚的に理解できる。

**この優先度の理由**: UXを大幅に向上させる機能だが、コア機能ではない。視覚化により複雑なブランチ構造の理解が容易になる。

**独立したテスト**: ブランチツリー表示画面で視覚的なグラフが表示され、ブランチ間の関係性が確認できることで完全にテストでき、コマンドラインでは把握しづらいブランチ構造を一目で理解できるという価値を提供します。

**受け入れシナリオ**:

1. **前提条件** 複数のブランチが存在、**操作** ブランチツリー画面にアクセス、**期待結果** すべてのブランチがツリー構造で視覚的に表示される
2. **前提条件** ブランチツリーが表示中、**操作** 任意のブランチをクリック、**期待結果** そのブランチの詳細情報（コミット履歴、差分）が表示される
3. **前提条件** ブランチツリーが表示中、**操作** マージ済みブランチを確認、**期待結果** マージ済みのブランチが別の色やアイコンで示される
4. **前提条件** ブランチツリーが表示中、**操作** ベースブランチを持つ任意のブランチノードにマウスオーバー、**期待結果** ノード同士が線で接続され、ツールチップに「base: <ベース名>」「divergence」などの補助情報が表示される

---

### ユーザーストーリー 7 - AIツール起動ロジックの共通化とフォールバック (優先度: P1)

Web UI と CLI のどちらからでも同じロジックで AI ツールを起動でき、`claude` / `codex` バイナリが存在しない環境でも Bun 経由のフォールバックでセッションを開始できる。また、必要な実行ファイルが1つも無い場合は即座に具体的なエラーを受け取れる。

**この優先度の理由**: 現状 Web UI だけがローカルバイナリ必須で失敗しており、最大の価値（ブラウザからAIツール操作）が提供できていない。CLI と同等の成功率を担保するため最優先とする。

**独立したテスト**: `claude` コマンドをアンインストールしたテスト環境で Web UI からセッションを開始し、bunx 経由で PTY が継続することを確認すればこのストーリー単独で価値を検証できる。

**受け入れシナリオ**:

1. **前提条件** `claude` が PATH に無く Bun はインストール済み、**操作** ブランチ詳細ページで Claude Code を起動、**期待結果** bunx 経由でセッションが起動し、ターミナルに「Connected to session...」の後も出力が継続する。
2. **前提条件** `codex` が存在しないが Bun はインストール済み、**操作** Codex CLI を選択して起動、**期待結果** bunx + パッケージ名で Codex CLI が起動し、Web UI から操作できる。
3. **前提条件** `claude` / `codex` / Bun のいずれも未インストール、**操作** いずれかのツールを起動、**期待結果** `POST /api/sessions` が 4xx/5xx とともに「必要なバイナリ/Bunが見つからない」と詳細なメッセージを返し、Web UI でも同じ内容が表示される。
4. **前提条件** PTY がすでに終了している、**操作** ブラウザが `resize`/`input` を送信、**期待結果** WebSocket が「セッションは終了しました」等の意味のあるエラーを返し、「Invalid message format」など誤解を招く文言にならない。

---

### ユーザーストーリー 8 - GitHub PR情報とWorktreeクリーンアップ (優先度: P1)

CLI / Web UI で GitHub PR 状態を参照し、マージ済み PR の Worktree を安全にクリーンアップできる。

**受け入れシナリオ**:

1. **前提条件** GitHub 認証済み、**操作 (CLI)** 「Merged PR cleanup」を実行、**期待結果** PR 番号・タイトル・Worktree パスが表示され削除できる
2. **前提条件** 同じリポジトリ、**操作 (Web)** Worktree 管理画面の「マージ済みPRのクリーンアップ」を押下、**期待結果** CLI と同じ候補が表示され、選択結果が一致する
3. **前提条件** ネットワーク遮断、**操作** クリーンアップを開始、**期待結果** CLI/Web 共に GitHub API エラーを表示して再試行を促す

### ユーザーストーリー 9 - Git 操作の安全性と差分表示 (優先度: P1)

開発者は CLI / Web UI を通じて divergence・保護ブランチ状態・fetch/pull 状況を確認し、安全な Git 操作を行える。

**受け入れシナリオ**:

1. **前提条件** リモートとの差分あり、**操作** CLI の divergence ビュー or Web の Divergence カード、**期待結果** ahead/behind 数と最新コミットが一致する
2. **前提条件** 保護ブランチ Worktree、**操作** 削除を試みる、**期待結果** CLI/Web 共に警告して既定ルールに従いブロックする
3. **前提条件** fetch/pull が必要、**操作** CLI で `r` を押す / Web の「リフレッシュ」ボタンを押す、**期待結果** Git fetch/pull が実行され、失敗時も同じエラー文言で案内する

**実装ノート (2025-11-11)**

- Webサーバーの `listBranches` は CLI と同じ `getBranchDivergenceStatuses()` を使用して ahead/behind 情報を収集し、REST API の `Branch.divergence` に反映する。これによりメトリクスやバッジ表示が CLI と完全一致する。
- ブランチ詳細ページは divergence の両方向差分（ahead > 0 かつ behind > 0）を検出した場合、CLI と同様に AI ツール起動ボタンを無効化し、差分解消手順（git fetch/pull/push）を案内する。

### ユーザーストーリー 10 - セッション履歴とエラー復旧 (優先度: P2)

CLI / Web UI の双方で過去の AI セッション履歴を確認し、依存欠如などのエラー時に共通の復旧手順が案内される。

**受け入れシナリオ**:

1. **前提条件** 過去セッションあり、**操作** CLI の Session History / Web の Sessions タブ、**期待結果** status/exit code/開始終了時刻が一致して表示される
2. **前提条件** Bun 未導入、**操作** Web からセッション開始、**期待結果** REST が 400 + インストールガイダンスを返し、CLI でも同じ文言を表示する (SC-009)
3. **前提条件** Claude バイナリのみ存在、**操作** Codex を起動、**期待結果** CLI/Web 共に不足メッセージと推奨手順を表示し、CLI の `Enter` 確認に相当する UI が Web に表示される
4. **前提条件** 依存パッケージのインストールが必要、**操作** CLI の dependency installer / Web の同等フローを開始、**期待結果** 進捗と失敗メッセージが共通フォーマットで表示され、失敗時は CLI の `waitForErrorAcknowledgement` に相当する確認/UI が Web にも表示される

---

### エッジケース

- ポートが既に使用中の場合、サーバーは別のポートで起動するか、エラーメッセージを表示するか？
- AI Toolの実行中にネットワーク接続が切断された場合、どのように処理されるか？
- 複数のブラウザタブで同時にAI Toolを起動した場合、セッションはどのように管理されるか？
- Worktree作成中にディスク容量が不足した場合、エラーはどのように通知されるか？
- 非常に大量のブランチ（1000以上）が存在する場合、パフォーマンスは許容範囲か？
- WebSocketの再接続中にAI Toolからの出力が失われないか？
- `tools.json`が破損している場合、設定管理画面はどのように動作するか？
- `claude`/`codex` のバイナリも Bun も存在しない場合、即座にガイド付きのエラーを返せているか？
- Bun のバージョンが 1.0 未満など要件を満たさない場合、フォールバックはどのように失敗を通知するか？
- PTY が起動直後に終了したセッションに対して、リサイズや入力が飛んできた場合にどう graceful に応答するか？

## 要件 *(必須)*

### 機能要件

#### サーバー起動と基盤

- **FR-001**: システムは`claude-worktree serve`コマンドでローカルWebサーバーを起動しなければならない
- **FR-002**: サーバーはデフォルトで`http://localhost:3000`でリッスンしなければならない
- **FR-003**: サーバーはポートが使用中の場合、エラーメッセージを表示して終了しなければならない
- **FR-004**: サーバーは`Ctrl+C`で正常にシャットダウンしなければならない
- **FR-005**: サーバーはフロントエンドの静的ファイル（HTML/CSS/JS）を配信しなければならない

#### ブランチ管理とWorktree操作

- **FR-006**: Web UIはローカルおよびリモートのすべてのブランチを一覧表示しなければならない
- **FR-007**: ユーザーはブランチ名で検索・フィルターできなければならない
- **FR-008**: ユーザーは任意のブランチを選択してWorktreeを作成できなければならない
- **FR-009**: システムは既存のWorktreeがあるブランチに対して、既存のWorktreeパスを表示しなければならない
- **FR-010**: ユーザーは既存のWorktree一覧を表示し、個別に削除できなければならない
- **FR-011**: システムはマージ済みPRのWorktreeを検出し、一括削除できなければならない
- **FR-012**: システムは保護ブランチ（main/master/develop）のWorktree削除時に警告を表示しなければならない

#### AI Tool起動とターミナル統合

- **FR-013**: ユーザーはAI Tool（Claude Code、Codex CLI、Custom Tool）を選択して起動できなければならない
- **FR-014**: ユーザーは起動モード（normal/continue/resume）を選択できなければならない
- **FR-015**: ユーザーはオプション（skipPermissions、bypassApprovalsなど）を設定できなければならない
- **FR-016**: システムはAI ToolをPTY（疑似端末）経由で起動しなければならない
- **FR-017**: Web UIはブラウザ内にターミナルエミュレーターを表示しなければならない
- **FR-018**: ターミナルはAI Toolの標準出力・エラー出力をリアルタイムで表示しなければならない
- **FR-019**: ターミナルはユーザーのキーボード入力をAI Toolに転送しなければならない
- **FR-020**: ターミナルはANSI escape codes（色、カーソル移動など）を正しく解釈して表示しなければならない
- **FR-021**: ターミナルはリサイズに対応し、新しいサイズでPTYを再調整しなければならない
- **FR-022**: システムはAI Toolセッションを管理し、複数の同時セッションをサポートしなければならない
- **FR-023**: システムはWebSocket接続が切断された場合、セッションをバックグラウンドで保持しなければならない
- **FR-024**: ユーザーは再接続時に過去の出力履歴を確認できなければならない

#### コマンド解決とフォールバック

- **FR-035**: CLI と Web UI は同一のコマンド解決モジュールを使用し、ツール種別・モード・追加フラグ・環境変数を一元的に決定しなければならない
- **FR-036**: コマンド解決モジュールは `claude` / `codex` バイナリが存在しない場合、Bun (`bunx`) + 対応 npm パッケージへのフォールバックを構築しなければならない
- **FR-037**: Bun も存在しない、または最低バージョンを満たさない場合、REST API は 4xx/5xx とともにインストール手順を含む詳細なエラーメッセージを JSON で返し、Web UI でも同じ内容を表示しなければならない
- **FR-038**: WebSocket ハンドラーは PTY が終了/未初期化の状態で `input` / `resize` を受け取った際、例外を投げずに `error` メッセージで原因を返し、「Invalid message format」のような誤解を招く表現を使用してはならない
- **FR-039**: Worktree の作成・削除・クリーンアップ・PR 判定は CLI/Web 共通の `WorktreeOrchestrator` / Git ロジックを使用しなければならない
- **FR-040**: Worktree 一覧に表示するメタ情報（パス、HEAD、PR情報、ロック状態、差分件数）は CLI / Web の双方で同じフィールドを表示しなければならない
- **FR-041**: `skipPermissions` / `bypassApprovals` / `extraArgs` / Custom Tool modeArgs など AI ツール起動オプションは CLI と Web で同じ API/フラグから指定できなければならない
- **FR-042**: セッション履歴（status, exitCode, startedAt, endedAt）は CLI と Web で共有し、片側で削除/終了した場合は他方にも即時反映されなければならない
- **FR-043**: Custom AI Tool（tools.json）の追加・編集・起動フローは CLI / Web 共通のスキーマと resolver を使用し、type/path/modeArgs が完全に一致しなければならない
- **FR-044**: Worktree dependency installer / `skipPermissions` 確認など CLI 固有の確認フローは Web UI にも同等の確認 UI（モーダル/トースト）を提供し、同じメッセージを表示しなければならない
- **FR-045**: `/api/worktrees`・`/api/worktrees/cleanup` 等の REST API は CLI と同じバリデーション（保護ブランチ禁止、Git fetch 失敗、ディスク不足、PR 状態確認）とエラーメッセージを提供しなければならない

#### 設定管理

- **FR-025**: Web UIは`~/.claude-worktree/tools.json`の内容を読み込んで表示しなければならない
- **FR-026**: ユーザーはカスタムAI Toolを追加・編集・削除できなければならない
- **FR-027**: システムはカスタムツールのバリデーション（必須フィールド、JSON構文）を行わなければならない
- **FR-028**: システムは設定変更を`tools.json`に保存しなければならない

#### Git操作ビジュアル化

- **FR-029**: Web UIはブランチツリーをグラフィカルに表示しなければならない
- **FR-030**: ユーザーは任意のブランチをクリックして詳細情報を表示できなければならない
- **FR-031**: システムはマージ済みブランチを視覚的に区別して表示しなければならない

#### CLI互換性

- **FR-032**: システムは既存の`claude-worktree`（CLI）機能を維持しなければならない
- **FR-033**: システムは`claude-worktree`と`claude-worktree serve`で異なる動作を提供しなければならない
- **FR-034**: CLIとWeb UIは共通のコアロジック（Git操作、Worktree管理）を共有しなければならない

### 主要エンティティ

- **Worktree**: 特定のGitブランチに対応する作業ディレクトリ。属性: ブランチ名、ファイルシステムパス、作成日時、現在の状態（アクティブ/アイドル）
- **Branch**: Gitブランチ。属性: ブランチ名、タイプ（local/remote）、最新コミットハッシュ、マージ状態（未マージ/マージ済み）、関連Worktreeパス
- **AIToolSession**: AI Tool実行セッション。属性: セッションID、ツールタイプ（Claude Code/Codex CLI/Custom）、モード、Worktreeパス、PTYプロセスID、WebSocket接続ID、開始時刻、終了時刻、出力ログ
- **CustomAITool**: ユーザー定義のカスタムAI Tool。属性: ツール名、コマンド、実行タイプ（path/bunx/command）、デフォルト引数、環境変数

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーはWebサーバーを5秒以内に起動でき、ブラウザでアクセスできる
- **SC-002**: ユーザーはブランチ一覧から任意のブランチを選択し、30秒以内にWorktreeを作成できる
- **SC-003**: ユーザーはAI Toolを起動し、ターミナル画面でリアルタイムな入出力を遅延なく（100ms以内）体験できる
- **SC-004**: システムは1000以上のブランチがある場合でも、ブランチ一覧を3秒以内に表示できる
- **SC-005**: ユーザーの95%が初回でWorktree作成とAI Tool起動を成功できる（チュートリアルなしで）
- **SC-006**: WebSocket接続が切断されても、再接続時にセッションが復元され、ユーザーは作業を中断なく継続できる
- **SC-007**: CLI版の既存ユーザーは、追加学習なしに`claude-worktree serve`コマンドを実行できる
- **SC-008**: `claude`/`codex` バイナリが存在しないが Bun があるテストケース（最低5件）で、Web UI のセッション起動成功率が100%になる
- **SC-009**: `claude`/`codex`/Bun が全て無いテストケースで、REST/WebSocket が返すエラーメッセージに必ず不足している依存関係と推奨インストール手順が含まれる（100%）
- **SC-010**: Worktree 作成/削除/マージ済みクリーンアップの E2E テスト（CLI & Web 各5件）で、削除対象・警告表示・結果サマリーが完全に一致する

## 制約と仮定 *(該当する場合)*

### 制約

- ローカル環境（localhost）でのみ動作し、リモートアクセスやマルチユーザー対応は行わない
- 既存のCLI機能を維持する必要があるため、コアロジックを破壊的に変更できない
- Gitリポジトリ内で実行される必要がある（非Gitディレクトリではエラー）
- AI Tool（Claude Code/Codex CLI）のローカルバイナリ、もしくは Bun 1.0 以上が必ず利用可能である必要がある（両方無い場合は明示的なエラーで案内する）
- Node.js ランタイムでサーバーが動作し、Bun は AI ツール起動フォールバック用に参照される

### 仮定

- ユーザーはモダンなブラウザ（Chrome、Firefox、Safari、Edge最新版）を使用している
- ユーザーはターミナル操作の基本的な知識がある
- ユーザーはGitの基本概念（ブランチ、Worktree）を理解している
- システムはローカルのファイルシステムに読み書き権限がある
- PTY（node-pty）がユーザーの環境で動作する（Windows/macOS/Linux）
- 少なくとも `claude` / `codex` のいずれか、もしくは Bun 1.0+ をインストールできる環境である

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- リモートサーバーへのデプロイとホスティング
- マルチユーザー対応と認証機能
- クラウドベースのGitリポジトリ管理
- モバイルアプリ（iOS/Android）
- AI Toolのライセンス管理や課金機能
- Gitの高度な操作（rebase、cherry-pick、merge conflict解決）
- コードエディタ機能（VSCodeのような統合開発環境）
- CI/CD統合
- チーム協業機能（リアルタイム共同編集など）

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- **ローカルアクセスのみ**: サーバーは`localhost`でのみリッスンし、外部ネットワークからのアクセスは許可しない
- **任意コマンド実行リスク**: カスタムAI Toolの設定でユーザーが任意のコマンドを実行できるため、`tools.json`の編集は慎重に行う必要がある（ユーザーの自己責任）
- **ファイルシステムアクセス**: Web UIはローカルのファイルシステム（Gitリポジトリ、`~/.claude-worktree/`）に読み書きアクセスするため、悪意あるスクリプトによる攻撃に注意が必要（サーバー側でパス検証を実施）
- **WebSocket通信**: ローカルネットワーク内の通信のため、TLS/SSL暗号化は不要（将来リモート対応する場合は必須）
- **セッション管理**: セッションIDは予測困難なランダム文字列（UUID）を使用し、セッションハイジャックを防止

## 依存関係 *(該当する場合)*

- **node-pty**: PTY（疑似端末）管理ライブラリ。AI ToolプロセスをPTYで起動するために必須
- **xterm.js**: ブラウザ側のターミナルエミュレーター。ANSI escape codesの解釈とレンダリングに必須
- **Fastify**: 高速なNode.js Webフレームワーク。REST APIとWebSocketサーバーの実装に使用
- **Vite**: モダンなフロントエンドビルドツール。React SPAのビルドと開発サーバーに使用
- **React 19**: UIフレームワーク。既存のInk（React for CLI）の知識を活用
- **既存のclaude-worktreeコア機能**: Git操作、Worktree管理、AI Tool起動ロジックを再利用
- **Bun 1.0+ (`bunx`)**: Claude/Codex CLI が存在しない環境でのフォールバック実行に使用

## 参考資料 *(該当する場合)*

- [既存のCLI実装](../../src/index.ts)
- [Ink UIコンポーネント](../../src/ui/components/)
- [node-ptyドキュメント](https://github.com/microsoft/node-pty)
- [xterm.jsドキュメント](https://xtermjs.org/)
- [Fastifyドキュメント](https://fastify.dev/)
