name: Check PR Base Branch

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  check-base:
    runs-on: ubuntu-latest
    steps:
      - name: Check if feature branch targets correct base
        if: startsWith(github.head_ref, 'feature/')
        run: |
          if [ "${{ github.base_ref }}" != "develop" ]; then
            echo "::error::Feature branches must target 'develop', not '${{ github.base_ref }}'"
            echo "::error::Please change the base branch to 'develop' using: gh pr edit ${{ github.event.pull_request.number }} --base develop"
            exit 1
          fi
          echo "✅ PR base branch is correct (develop)"

      - name: Check if hotfix branch targets correct base
        if: startsWith(github.head_ref, 'hotfix/')
        run: |
          if [ "${{ github.base_ref }}" != "main" ]; then
            echo "::error::Hotfix branches must target 'main', not '${{ github.base_ref }}'"
            echo "::error::Please change the base branch to 'main' using: gh pr edit ${{ github.event.pull_request.number }} --base main"
            exit 1
          fi
          echo "✅ PR base branch is correct (main)"

      - name: Provide guidance
        if: failure()
        run: |
          echo "Branch naming convention:"
          echo "  - feature/* → develop"
          echo "  - hotfix/*  → main"
          echo ""
          echo "To fix this PR, run:"
          echo "  gh pr edit ${{ github.event.pull_request.number }} --base <correct-base>"
